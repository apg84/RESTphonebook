/* Acceptance criteria:
       List all entries in the phonebook
       Create new entry into the phonebook
       Find an entry by surname
       Remove an existing entry
       Update an existing entry in the phonebook
       The details are:
       name 
       surname
       phone number 
       address (optional)
*/




//Create new entry -> POST request
//Find an entry by surname -> GET request
//Remove an existing entry -> DELETE request
//Update an existing entry -> PUT request

var should = require('chai'),
app = require("../server.js"),
supertest = require('supertest-as-promised'),
request = supertest('http://localhost:3001'),
entry = require('./testentries.js');

describe('phonebook', function() {
//List all entries -> GET request
//The entries will be listed in json format so,
//to start with we are expecting a 200 response
//+ json.

/*    beforeEach(function(done) {
	
	request.get('/phonebook')
	    .end(function(err, res) {
		if(err) return done(err);
		var entries = res.body;
		if(entries.length > 0) {
		    
		    entries.forEach(function(entry){
			request.del('/phonebook/'+ entry._id)
			.end(function(err, res) {
			    console.log(res);
			    res.status.should.equal(200);
			    res.body.should.equal(entry._id);
			    done();
			});
		    
		});
		done();
	    }
//	done();
	    });
    });*/

    it('is reachable and responds with json', function(done) {
	request.get('/phonebook')
	    .expect('Content-Type', /json/)
	    .expect(200, done);
   });
    
    it('allows adding new full entries', function(done) {
	request.post('/phonebook')
	    .send(entry.fullEntry)
	    .expect('Content-Type', /json/)
	    .expect(201)
	    .end(function(err, res) {
		if(err) return done(err);
		done();
	    });
	
    });
    
    it('allows adding entries with no address', function(done) {
	request.post('/phonebook/')
	.send(entry.partialEntry)
	.expect('Content-Type', /json/)
	.expect(201)
	.end(function(err, res) {
	    if(err) return done(err);
	    done();
	});
    });

    it('refuses to add entries that are not well formed', function(done) {
	console.log(entry.errNoPhone);
	request.post('/phonebook/')
	.send(entry.partialEntry)
	.expect(404)
	.end(function(err, res) {
		res.status.should.equal(404);
		done();
	});
//	done();
    });



});
